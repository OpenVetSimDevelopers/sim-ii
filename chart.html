<!DOCTYPE html>
<html>
	<head>
		<title>EKG</title>
		<link rel="shortcut icon" href="favico.ico" />
		<meta charset="UTF-8">
		<script type="text/javascript" src="//code.jquery.com/jquery-2.0.2.min.js"></script>
<script>

var enabled = 1;
var interval = 0;

$( document ).ready(function() {
	interval = setInterval(drawStrip, 10 );
	$('#stop').click(function(){
		if ( interval != 0 )
		{
			clearInterval(interval );
			interval = 0;
		}
	});
});

var stripWidth = 800;
var stripHeight = 262;
var stripPosition = 0;

var ekgOffsetX = 10;
var ekgHeight = 40;
var ekgOffsetY = 20;
var ekgLastX = -100;
var ekgLastY = -100;

function drawStrip()
{
	var i;
	var x;
	var y;
	var sample;
	var canvas = document.getElementById("strip");
	var ctx = canvas.getContext("2d");
	
	// Clear the current and next two lines
	ctx.fillStyle="black";
	x = stripPosition;
	ctx.clearRect(x+ekgOffsetX, ekgOffsetY, 6, stripHeight );
	
	// EKG
	sample = getEkgSample();
	x = stripPosition + ekgOffsetX;
	y = ekgOffsetY + ekgHeight - sample;
	ctx.strokeStyle="red";
	if ( ekgLastX == -100 )
	{
		ctx.fillRect(x,y,1,1);
	}
	else
	{
		ctx.beginPath();
		ctx.moveTo(ekgLastX, ekgLastY );
		ctx.lineTo(x,y);
		ctx.stroke();
	}
	ekgLastX = x;
	ekgLastY = y;


	
	stripPosition += 1;
	if ( stripPosition > stripWidth )
	{
		stripPosition = 0;
		ekgLastX = -100;
	}
}
</script>
<style>
.page-head
{
	position:relative;
	padding-bottom:20px;
}

#head-title
{
	font-weight: bold;
	display:inline;
}


.webImg
{
	display: none;
}
.stripCanvas
{
	border: solid black 8px;
	background: black;
}
</style>
	</head>
	<body>
		<div class='page-wrapper' >
			<div class='page-container' >
				<div class='page-head' >
					<h1 id='head-title'>EKG Strip Chart in HTML5 canvas </h1>
				</div>

				<canvas id='strip' class='stripCanvas' width="800" height="262" >
					
				</canvas>
			</div>
			<button id="stop">Stop</button>
		</div>
	</body>
<script>
var ekgSamples = [ 
 0,  0,  0,  0,  0,  0,  1,  2,  3,  2, 
 1,  0,  0,  1,  3,  6, 10, 16, 24, 32,
24, 16, 10,  6,  3,  1,  0,  0,  0,  0,
 0,  0,  1,  3,  5,  6,  5,  3,  1,  1,
 1,  2,  3,  4,  5,  5,  4,  3,  2,  1,
 1,  1,  0,  0, -1,  0
];

var numEkgSamples = ekgSamples.length;
var ekgIndex = 0;
var numExtra = 0;
var delay = Math.floor(Math.random() * 50);

function getEkgSample()
{
	var val;
	
	ekgIndex += 1;
	if ( ekgIndex >= numEkgSamples )
	{
		if ( ekgIndex >= (numEkgSamples + delay) )
		{
			ekgIndex = 0;
			val = 0;
			delay = Math.floor(Math.random() * 50);
		}
		else
		{
			val = Math.floor((Math.random() * 4) + 1);
		}
	}
	else
	{
		val = ekgSamples[ekgIndex];
	}
	return Math.floor(val );
}

</script>
</html>
